<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Phaser - Rocks Demo</title>
    <script src="demo%20snippets/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">


var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update});
var g_eggs = [];  // global array to hold all eggs
var g_rocks = [];	// global array to hold all rocks
var g_hitCount = [];

    
function egg(x, y) {
	this.x = x;
	this.y = y;
    this.hitCounter = 0; 
	
    
}
    
function preload() {
    game.load.image('rock', 'assets/rock.png');
    game.load.image('ground', 'assets/platform.png');
    game.load.image('fragment', 'assets/rock_fragment.png');
    
    //change width of frame later
    game.load.spritesheet('egg', 'assets/egg_spritesheet.png',103,126);
}
    
var rock;
var platforms;
var egg1;

function create() {
    
   game.physics.startSystem(Phaser.Physics.ARCADE);
   platforms = game.add.group();
   platforms.enableBody = true;
   var ground = platforms.create(0, game.world.height - 64, 'ground');
   ground.scale.setTo(2,2);
   ground.body.immovable = true;
    
    
   CreateRocks(1);
   //add text
   rock.inputEnabled = true;
   var style = { font: "14px Arial", fill: "#ff0044", wordWrap: true, wordWrapWidth: rock.width, align: "center"};

    text = game.add.text(0, 0, "Equation", style);
    text.anchor.set(0.5);
    
    CreateEggs(1);
 
   
}

function update() {

    var hitPlatform = game.physics.arcade.collide(egg,platforms);
    game.physics.arcade.collide(rock,platforms);
    game.physics.arcade.overlap(egg,rock,hatchEgg,null,this);
    text.x = Math.floor(rock.x + rock.width / 2);
    text.y = Math.floor(rock.y + rock.height / 2);

}

function hatchEgg(eggSprite,rock){

    //to update this variable once we have an array of hits
    var hitEggIndex = g_eggs.indexOf(eggSprite);
    
    var hits = ++g_hitCount[hitEggIndex];
    
    destroyObject(rock);
    destroyObject(text);
    if(hits!=3)
        CreateRocks(1);
    switch(hits){
        case 1 : eggSprite.tint = 0x00ff00;
                break;
        case 2 : eggSprite.tint = 0xff0000;
                break
        case 3 :   eggSprite.animations.play('hatch', 2, false);
                break;
            
    }
    
}

function destroyObject(obj) {

    obj.destroy();

}

function CreateEggs(numEggs){
	
	var w = 60, h = 100, x = 50, y = 440;
	for(var i=0; i<numEggs; i++){
        egg = game.add.sprite(32,game.world.height-150, 'egg');
        game.physics.arcade.enable(egg);
        egg.body.bounce.y = 0.2;
        egg.body.gravity.y = 300;
        egg.body.collideWorldBounds = true;
//		x = x+200;
        egg.animations.add('hatch');
		g_eggs.push(egg);
        g_hitCount.push(0);
        
	}
}

function CreateRocks(numRocks){
	var _y = 200, _x = 50;
	for(var i=0; i < numRocks; i++){
        
        
        rock = game.add.sprite(20,40,'rock');
        game.physics.arcade.enable(rock);
        rock.body.gravity.y = 50;
        rock.body.collideWorldBounds = true;
        rock.scale.x = 0.15;
        rock.scale.y = 0.15;
        g_rocks.push(rock);
     
	}
}
</script>

</body>
</html>

